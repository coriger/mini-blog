package com.clo.web.restservice;


import java.util.Date;
import java.util.Map;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;

import com.clo.keno.service.UserService;
import com.clo.keno.vo.UserVo;







@Controller
public class RestController{

	private static Log logger = LogFactory.getLog(RestController.class);

    @Autowired
    private UserService userService;

//
//	@RequestMapping(value="/remote/hello",method=RequestMethod.GET)
//	public ResponseEntity<String> echo(@RequestParam("name") String name) {
//		logger.debug("------------------------------->"+name);
//		return new ResponseEntity<String>("hello "+name,null,HttpStatus.OK);
//	}


    /**
     * 新增一个用户
     * @param uservo
     * @return
     */
//	@RequestMapping(value="/remote/addUser",method=RequestMethod.POST)
//	public ResponseEntity<Boolean> addUser(@RequestParam("username") String username,@RequestParam("pwd") String pwd) {
////		UserVo uservo = new UserVo();
////		uservo.setUsername(username);
////		uservo.setPwd(pwd);
////		uservo.setRegistertime(new Date());
//		//logger.debug("------------------------------->uservo :"+uservo.toString());
//        boolean result = userService.insertRedisUser(username+"|"+pwd);
//        //logger.debug("------------------------------->"+result);
//		return new ResponseEntity<Boolean>(result,null,HttpStatus.OK);
//	}

    /**
     * 新增一个用户(支持事务处理)
     * @param uservo
     * @return
     */
	@RequestMapping(value="/action/addDbUser",method=RequestMethod.POST)
	public ResponseEntity<Boolean> addUser1(@RequestBody UserVo uservo) {
		
		//logger.debug("------------------------------->uservo :"+uservo.toString());
		
		try {
			userService.insertUser(uservo);
		} catch (Exception e) {
			// TODO: handle exception
			return new ResponseEntity<Boolean>(false,null,HttpStatus.OK);
		}
        //logger.debug("------------------------------->"+result);
		return new ResponseEntity<Boolean>(true,null,HttpStatus.OK);
	}
	
	
	@RequestMapping(value="/index",method=RequestMethod.POST)
	public String index(Map<String,Object> model) {
		return "index";
	}


    /**
     * 新增一个用户
     * @param uservo
     * @return
     */
	@RequestMapping(value="/action/addRedisUser",method=RequestMethod.POST)
	public ResponseEntity<Boolean> addRedisUser(@RequestBody UserVo uservo) {
		uservo.setRegistertime(new Date());
		//logger.debug("------------------------------->uservo :"+uservo.toString());
        boolean result = userService.insertRedisUser(uservo);
        //logger.debug("------------------------------->"+result);
		return new ResponseEntity<Boolean>(result,null,HttpStatus.OK);
	}



}
